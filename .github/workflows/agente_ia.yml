name: Agente IA responde Issue (GPT-3.5)

on:
  issues:
    types: [opened]

jobs:
  responder-issue:
    runs-on: ubuntu-latest

    permissions:
      issues: write
      contents: read

    steps:
      - name: Checkout repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install openai

      - name: Ejecutar agente IA
        id: agente
        env:
          OPENAI_API_KEY: ${{ secrets.OPEN_API_KEY }}
        run: |
          RESULTADO=$(python agente_ia.py "${{ github.event.issue.title }}")
          echo "RESULTADO<<EOF" >> $GITHUB_ENV
          echo "$RESULTADO" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Comentar resultado en el Issue
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh issue comment ${{ github.event.issue.number }} --body "
          ### ðŸ¤– CÃ³digo generado automÃ¡ticamente (GPT-3.5)

          Lenguaje solicitado: **${{ github.event.issue.title }}**

          \`\`\`
          ${{ env.RESULTADO }}
          \`\`\`
          "
